<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PLATO Simulator: Scripting in Python</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PLATO Simulator
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">An end-to-end simulator for the Plato mission.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Scripting in Python </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The basic functionality of the C++ code is to model a part (i.e. sub-field) of one of the four CCD that are attached to the normal camera (A, B, C, or D) or to the fast camera (AF, BF, CF, or DF) of one of the telescopes on the platform. You can initiate PLATO simulations from within Python, e.g. to automatically select the correct CCD or to combine multiple telescopes on the platform.</p>
<p>Under <code>/docs/tutorials/ScriptingInPython</code> you can find a basic tutorial on scripting PlatoSim3 in Python.</p>
<p>We advise you to install <a href="https://docs.continuum.io/anaconda/install">Anaconda</a> as Python distribution, as this already has most of the required packages installed. It comes with a GUI, called Spyder, from which you can run your Python scripts.</p>
<h2>Configuring Python</h2>
<h3>Creating a Python Environment</h3>
<p>With <a href="http://conda.pydata.org/docs/index.html">conda</a> (which is included in <a href="https://docs.continuum.io/anaconda/install">Anaconda</a>), you can create, export, list, remove, and update environments that have different versions of Python and/or packages installed in them. Switching or moving between environments is called activating the environment.</p>
<p>To create and activate such an environment, type</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;source /anaconda/bin/activate root</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;conda create -n platoSim python=3.5 anaconda</div></div><!-- fragment --><p>More information on managing environment with conda can be found <a href="http://conda.pydata.org/docs/using/envs.html#">here</a>.</p>
<h3>Installing Extra Packages</h3>
<p>To be able to run the PLATO Simulator and inspect the output, you must install the following packages:</p>
<ul>
<li><a href="http://www.numpy.org/">numpy</a>, a fundamental package for scientific computing in Python,</li>
<li><a href="http://matplotlib.org/">matplotlib</a>, a 2D plotting package,</li>
<li><a href="https://pypi.python.org/pypi/pyaml">pyaml</a>, to deal with the configuration files in <a href="https://learnxinyminutes.com/docs/yaml/">YAML</a> format,</li>
<li>and <a href="http://www.pytables.org/">pytables</a>, to inspect the output files in <a href="https://www.hdfgroup.org/HDF5/">HDF5</a> format.</li>
</ul>
<p>These packages can be installed with the following commands:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;conda install numpy</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;conda install matplotlib</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;conda install pytables</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;pip install pyaml</div></div><!-- fragment --><p>As it comes to the choice between <code>conda install</code> and <code>pip install</code>: first try <code>conda install</code>, and - if that doesn't work - then try <code>pip install</code> (or <code>pip3 install</code> if you're using Python3).</p>
<h3>Managing your Python Path</h3>
<p>The Python functionality that is offered in PlatoSim3 can be found in the <code>python</code>. Make sure to add this directory to your Python path, as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;PYTHONPATH=$PYTHONPATH:&lt;full path to the /Platosim3/python directory&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;export PYTHONPATH</div></div><!-- fragment --><p>In Spyder, click on the "Python Path Manager" button to add the path to this directory to your Python path.</p>
<h2>Running PlatoSim3 in Python</h2>
<h3>Creating a <code>Simulation</code> Object</h3>
<p>To run PlatoSim from within Python, you have to import the <code>simulation</code> module:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">import</span> simulation</div></div><!-- fragment --><p>and create a new <code>Simulation object</code> (the name <code>sim</code> is arbitrary):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sim = Simulation(&lt;runName&gt;, configurationFile = &lt;full path to the configuration file&gt;, outputDir = &lt;full path to the output directory&gt;)</div></div><!-- fragment --><p>Note that you can use the working directory (i.e. the directory specified in the <code>PLATO_WORKDIR</code>) environment variable to specify the path to the input configuration file or the output directory. To read the content of this environment variable in Python, use</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">import</span> os</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;workDir = os.environ[<span class="stringliteral">&quot;PLATO_WORKDIR&quot;</span>]</div></div><!-- fragment --><h4>Input Configuration File</h4>
<p>The <code>configurationFile</code> parameter is optional and contains the full path to the configuration file that will be used as a reference. A copy of this file will be stored in the output directory (with the name <code>runName.yaml</code>) and only the copy (and not the original file) will be modified. We will show later how to do this.</p>
<p>If not specified, the <code>inputfile.yaml</code> configuration file from the <code>/inputfiles</code> directory will be used (provided you have exported the <code>PLATO_PROJECT_HOME</code> environment variable). It is possible to also set the path to the reference input file as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sim.readConfigurationFile(&lt;full path to the configuration file&gt;)</div></div><!-- fragment --><p>In that case, all changes to the configuration parameters you may have applied, will be overwritten.</p>
<h4>Output Directory</h4>
<p>Also the <code>outputDir</code> parameter is optional. This contains the full path to the output directory. This must be specified before you can start the simulation. The output directory can be set can also be set as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sim.outputDir = &lt;full path to the output directory&gt;</div></div><!-- fragment --><p>In this directory, the following information will be stored when running the simulation:</p>
<ul>
<li><code>runName.yaml</code>: copy of the input file with the chosen configuration parameters (copied from the reference configuration file and possibly modified, as shown below);</li>
<li><code>runName.hdf5</code>: resulting exposures (images, PSF, etc.);</li>
<li><code>runName.log</code>: log file (to report any problems).</li>
</ul>
<h3>Modifying Configuration Parameters</h3>
<p>Individual configuration parameters can be modified in the copy of the configuration file (which will be stored with the name <code>runName.yaml</code> in the output directory) as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sim[<span class="stringliteral">&quot;&lt;block&gt;/&lt;parameter&gt;&quot;</span>] = &lt;new value&gt;</div></div><!-- fragment --><p>for individual parameters in the block of the YAML file (e.g. <code>sim["Camera/FocalPlaneOrientation"] = 0</code>), or</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sim[<span class="stringliteral">&quot;&lt;block&gt;/&lt;sub-block&gt;/&lt;parameter&gt;&quot;</span>] = &lt;new value&gt;</div></div><!-- fragment --><p>for parameters in sub-block in the YAML file (e.g. <code>sim["PSF/Gaussian/Sigma"] = 0.50</code>). Note that the original YAML file is not modified. Only the copy of this fill gets modified. In case you change the configuration file of the <code>Simulation</code> object, the copy <code>runName.yaml</code> file will be overwritten and all changes to the configuration parameters you have applied, will be lost.</p>
<p>A detailed description of the configuration parameters can be found <a class="el" href="InputFileDescription.html">here</a>.</p>
<h3>Running the Simulation</h3>
<p>The simulation can be executed with the following command:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sim.run()</div></div><!-- fragment --><p>By setting the optional input parameter <code>removeOutputFile</code> to <code>True</code>, any files with the same names in the specified output directory will be deleted first:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sim.run(removeOutputFile = <span class="keyword">True</span>)</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
